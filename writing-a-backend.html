<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Laika 0.18.1 + Helium Theme" />
    <title>Writing an Explore Backend</title>
    
      <meta name="author" content="Noel Welsh"/>
    
    
      <meta name="description" content="docs"/>
    
    
      <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@1.207/distr/fira_code.css">
    
    <link rel="stylesheet" type="text/css" href="helium/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="helium/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="site/styles.css" />
    <script src="helium/laika-helium.js"></script>
    <script src="main.js"></script>
    <script src="main.js"></script>
    <script src="helium/laika-helium.js"></script>
    
    
    <script> /* for avoiding page load transitions */ </script>
  </head>

  <body>

    <header id="top-bar">

      <div class="row">
        <a id="nav-icon">
          <i class="icofont-laika" title="Navigation">&#xefa2;</i>
        </a>
        
      </div>

      <a class="icon-link" href="https://creativescala.org"><i class="icofont-laika" title="Home">&#xef47;</i></a>

      <span class="row links"><a class="icon-link svg-link" href="https://github.com/creativescala/doodle-explore"><span title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a></span>

    </header>

    <nav id="sidebar">

      <div class="row">
        <a class="icon-link svg-link" href="https://github.com/creativescala/doodle-explore"><span title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
      </div>

      <ul class="nav-list">
        <li class="level1"><a href="index.html">Doodle Explore</a></li>
        <li class="level1"><a href="using-explore.html">Making an Explorer for your Art Piece</a></li>
        <li class="level1"><a href="explorer-types.html">Explorer Types</a></li>
        <li class="level1 active"><a href="#">Writing an Explore Backend</a></li>
      </ul>

      <ul class="nav-list">
        <li class="level1 nav-header">Related Projects</li>
        
          <li class="level2"><a href="https://creativescala.org/doodle">Doodle</a></li>
        
          <li class="level2"><a href="https://creativescala.github.io/doodle-svg">Doodle SVG</a></li>
        
          <li class="level2"><a href="https://creativescala.org">Creative Scala</a></li>
        
      </ul>

    </nav>

    <div id="container">

      <nav id="page-nav">
        <p class="header"><a href="#">Writing an Explore Backend</a></p>

        <ul class="nav-list">
          <li class="level1"><a href="#a-minimal-java2d-backend">A minimal Java2D backend</a></li>
          <li class="level2"><a href="#implementing-exploreint">Implementing ExploreInt</a></li>
          <li class="level2"><a href="#implementing-layout">Implementing Layout</a></li>
        </ul>

        <p class="footer"></p>
      </nav>

      <main class="content">

        <h1 id="writing-an-explore-backend" class="title">Writing an Explore Backend</h1>
        <p>Explore backends are implemented as an interpreter for each supported input type.
        Each interpreter implements an <code>Explore*</code> trait for a backend-specific component type.
        Along with the interpreters for each supported input type, there should be an interpreter for 
        the <code>Layout</code> trait, so that multiple components can be composed. Additionally, the component type
        must extend the <code>Explorer</code> trait parameterized by the targeted doodle backend&#39;s <code>Drawing</code>, <code>Algebra</code>,
        <code>Canvas</code>, and <code>Frame</code> type. The reference backend implementation is <code>doodle.explore.java2d.Component.scala</code>.</p>
        
        <h2 id="a-minimal-java2d-backend" class="section">A minimal Java2D backend<a class="anchor-link right" href="#a-minimal-java2d-backend"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>Let&#39;s write a minimal Java2D backend with an implementation for <code>IntExplore</code> and <code>Layout</code>.
        We&#39;ll start with our <code>Component</code> type. It is easiest expressed as a Scala 3 enum with a
        case for each type of input. We&#39;ll use <code>doodle.java2d.{Drawing, Algebra, Canvas, Frame}</code>
        as our Doodle backend.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">enum</span><span> </span><span class="type-name">Component</span><span>[</span><span class="type-name">A</span><span>] </span><span class="keyword">extends</span><span> </span><span class="type-name">Explorer</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">Drawing</span><span>, </span><span class="type-name">Algebra</span><span>, </span><span class="type-name">Canvas</span><span>, </span><span class="type-name">Frame</span><span>] {
    ...

    </span><span class="keyword">def</span><span> </span><span class="declaration-name">run</span><span>: </span><span class="type-name">Stream</span><span>[</span><span class="type-name">Pure</span><span>, </span><span class="type-name">A</span><span>] = ??? </span><span class="comment">// required by the Explorer trait
</span><span>}</span></code></pre>
        
        <h3 id="implementing-exploreint" class="section">Implementing ExploreInt<a class="anchor-link right" href="#implementing-exploreint"><i class="icofont-laika">&#xef71;</i></a></h3>
        <p>To figure out the representation of our int subtype, we can look at what&#39;s
        needed to implement <code>ExploreInt</code>.</p>
        <pre><code class="nohighlight"><span class="keyword">enum</span><span> </span><span class="type-name">Component</span><span>[</span><span class="type-name">A</span><span>] </span><span class="keyword">extends</span><span> </span><span class="type-name">Explorer</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">Drawing</span><span>, </span><span class="type-name">Algebra</span><span>, </span><span class="type-name">Canvas</span><span>, </span><span class="type-name">Frame</span><span>] {
    </span><span class="keyword">case</span><span> </span><span class="type-name">IntIR</span><span>(</span><span class="identifier">label</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">bounds</span><span>: (</span><span class="type-name">Int</span><span>, </span><span class="type-name">Int</span><span>), </span><span class="identifier">initial</span><span>: </span><span class="type-name">Int</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">Component</span><span>[</span><span class="type-name">Int</span><span>]

    </span><span class="keyword">def</span><span> </span><span class="declaration-name">run</span><span>: </span><span class="type-name">Stream</span><span>[</span><span class="type-name">Pure</span><span>, </span><span class="type-name">A</span><span>] = {
        </span><span class="keyword">val</span><span> </span><span class="identifier">frame</span><span> = </span><span class="type-name">JFrame</span><span>(</span><span class="string-literal">&quot;Explorer&quot;</span><span>)

        </span><span class="keyword">val</span><span> (</span><span class="identifier">ui</span><span>, </span><span class="identifier">values</span><span>) = </span><span class="keyword">this</span><span> </span><span class="keyword">match</span><span> {
            </span><span class="keyword">case</span><span> </span><span class="type-name">IntIR</span><span>(</span><span class="identifier">labelText</span><span>, (</span><span class="identifier">start</span><span>, </span><span class="identifier">end</span><span>), </span><span class="identifier">initial</span><span>) =&gt;
                </span><span class="keyword">val</span><span> </span><span class="identifier">panel</span><span> = </span><span class="type-name">JPanel</span><span>()
                </span><span class="keyword">val</span><span> </span><span class="identifier">label</span><span> = </span><span class="type-name">JLabel</span><span>(</span><span class="identifier">labelText</span><span>)
                </span><span class="keyword">val</span><span> </span><span class="identifier">slider</span><span> = </span><span class="type-name">JSlider</span><span>(</span><span class="identifier">start</span><span>, </span><span class="identifier">end</span><span>, </span><span class="identifier">initial</span><span>)

                </span><span class="identifier">panel</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">label</span><span>, </span><span class="identifier">panel</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">slider</span><span>))
                </span><span class="keyword">val</span><span> </span><span class="identifier">values</span><span> = </span><span class="type-name">Stream</span><span>(</span><span class="identifier">initial</span><span>).</span><span class="identifier">repeat</span><span>.</span><span class="identifier">map</span><span>(</span><span class="identifier">_</span><span> =&gt; </span><span class="identifier">slider</span><span>.</span><span class="identifier">getValue</span><span>)

                (</span><span class="identifier">panel</span><span>, </span><span class="identifier">values</span><span>)
        }

        </span><span class="comment">// displaying the UI
</span><span>        </span><span class="identifier">frame</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">ui</span><span>)
        </span><span class="identifier">frame</span><span>.</span><span class="identifier">setVisible</span><span>(</span><span class="boolean-literal">true</span><span>)
        </span><span class="identifier">frame</span><span>.</span><span class="identifier">pack</span><span>

        </span><span class="comment">// returning the values stream
</span><span>        </span><span class="identifier">values</span><span>
    }
}</span></code></pre>
        <p>Next, we have to write the actual <code>ExploreInt</code> implementation, using
        <code>Component</code> as the internal type:</p>
        <pre><code class="nohighlight"><span class="keyword">implicit</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">IntInterpreter</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">ExploreInt</span><span>[</span><span class="type-name">Component</span><span>] {
  </span><span class="keyword">import</span><span> </span><span class="type-name">Component</span><span>.</span><span class="type-name">IntIR</span><span>

  </span><span class="comment">// Construct a brand new IntIR
</span><span>  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">int</span><span>(</span><span class="identifier">label</span><span>: </span><span class="type-name">String</span><span>) = </span><span class="type-name">IntIR</span><span>(</span><span class="identifier">label</span><span>, </span><span class="type-name">None</span><span>, </span><span class="number-literal">0</span><span>)

  </span><span class="comment">// Pattern match to retrieve `generator` as the IntIR subtype, and then
</span><span>  </span><span class="comment">// update it.
</span><span>  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">within</span><span>(</span><span class="identifier">generator</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">Int</span><span>], </span><span class="identifier">start</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">end</span><span>: </span><span class="type-name">Int</span><span>) =
    </span><span class="identifier">generator</span><span> </span><span class="keyword">match</span><span> {
      </span><span class="keyword">case</span><span> </span><span class="identifier">generator</span><span>: </span><span class="type-name">IntIR</span><span> =&gt;
        </span><span class="identifier">generator</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">bounds</span><span> = </span><span class="type-name">Some</span><span>(</span><span class="identifier">start</span><span>, </span><span class="identifier">end</span><span>), </span><span class="identifier">initial</span><span> = (</span><span class="identifier">start</span><span> + </span><span class="identifier">end</span><span>) / </span><span class="number-literal">2</span><span>)
    }

  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">withDefault</span><span>(</span><span class="identifier">generator</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">Int</span><span>], </span><span class="identifier">newInitial</span><span>: </span><span class="type-name">Int</span><span>) =
    </span><span class="identifier">generator</span><span> </span><span class="keyword">match</span><span> {
      </span><span class="keyword">case</span><span> </span><span class="identifier">generator</span><span>: </span><span class="type-name">IntIR</span><span> =&gt; 
        </span><span class="identifier">generator</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">initial</span><span> = </span><span class="identifier">newInitial</span><span>)
    }
}</span></code></pre>
        <p>This implementation will work for a single int slider, but we can&#39;t
        compose them until there&#39;s an implementation for <code>Layout</code>.</p>
        
        <h3 id="implementing-layout" class="section">Implementing Layout<a class="anchor-link right" href="#implementing-layout"><i class="icofont-laika">&#xef71;</i></a></h3>
        <p>Implementing Layout with Java2D requires a slight restructuring. We want
        our whole GUI to fit in the same window, so we can only create one JFrame.
        The easiest way to solve this is to extract the UI creation logic into a
        separate function and let <code>run</code> handle creating the JFrame after the whole
        UI JComponent has been constructed. We&#39;ll call the new function <code>runAndMakeUI</code>.
        Now our <code>Component</code> looks like this:</p>
        <pre><code class="nohighlight"><span class="keyword">enum</span><span> </span><span class="type-name">Component</span><span>[</span><span class="type-name">A</span><span>] </span><span class="keyword">extends</span><span> </span><span class="type-name">Explorer</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">Drawing</span><span>, </span><span class="type-name">Algebra</span><span>, </span><span class="type-name">Canvas</span><span>, </span><span class="type-name">Frame</span><span>] {
    </span><span class="keyword">case</span><span> </span><span class="type-name">IntIR</span><span>(</span><span class="identifier">label</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">bounds</span><span>: (</span><span class="type-name">Int</span><span>, </span><span class="type-name">Int</span><span>), </span><span class="identifier">initial</span><span>: </span><span class="type-name">Int</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">Component</span><span>[</span><span class="type-name">Int</span><span>]

    </span><span class="keyword">def</span><span> </span><span class="declaration-name">runAndMakeUI</span><span>: (</span><span class="type-name">JComponent</span><span>, </span><span class="type-name">Stream</span><span>[</span><span class="type-name">Pure</span><span>, </span><span class="type-name">A</span><span>]) = </span><span class="keyword">this</span><span> </span><span class="keyword">match</span><span> {
        </span><span class="keyword">case</span><span> </span><span class="type-name">IntIR</span><span>(</span><span class="identifier">labelText</span><span>, (</span><span class="identifier">start</span><span>, </span><span class="identifier">end</span><span>), </span><span class="identifier">initial</span><span>) =&gt;
            </span><span class="keyword">val</span><span> </span><span class="identifier">panel</span><span> = </span><span class="type-name">JPanel</span><span>()
            </span><span class="keyword">val</span><span> </span><span class="identifier">label</span><span> = </span><span class="type-name">JLabel</span><span>(</span><span class="identifier">labelText</span><span>)
            </span><span class="keyword">val</span><span> </span><span class="identifier">slider</span><span> = </span><span class="type-name">JSlider</span><span>(</span><span class="identifier">start</span><span>, </span><span class="identifier">end</span><span>, </span><span class="identifier">initial</span><span>)

            </span><span class="identifier">panel</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">label</span><span>, </span><span class="identifier">panel</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">slider</span><span>))
            </span><span class="keyword">val</span><span> </span><span class="identifier">values</span><span> = </span><span class="type-name">Stream</span><span>(</span><span class="identifier">initial</span><span>).</span><span class="identifier">repeat</span><span>.</span><span class="identifier">map</span><span>(</span><span class="identifier">_</span><span> =&gt; </span><span class="identifier">slider</span><span>.</span><span class="identifier">getValue</span><span>)

            (</span><span class="identifier">panel</span><span>, </span><span class="identifier">values</span><span>)
    }

    </span><span class="keyword">def</span><span> </span><span class="declaration-name">run</span><span>: </span><span class="type-name">Stream</span><span>[</span><span class="type-name">Pure</span><span>, </span><span class="type-name">A</span><span>] = {
        </span><span class="keyword">val</span><span> </span><span class="identifier">frame</span><span> = </span><span class="type-name">JFrame</span><span>(</span><span class="string-literal">&quot;Explorer&quot;</span><span>)

        </span><span class="keyword">val</span><span> (</span><span class="identifier">ui</span><span>, </span><span class="identifier">values</span><span>) = </span><span class="identifier">runAndMakeUI</span><span>

        </span><span class="comment">// displaying the UI
</span><span>        </span><span class="identifier">frame</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">ui</span><span>)
        </span><span class="identifier">frame</span><span>.</span><span class="identifier">setVisible</span><span>(</span><span class="boolean-literal">true</span><span>)
        </span><span class="identifier">frame</span><span>.</span><span class="identifier">pack</span><span>

        </span><span class="comment">// returning the values stream
</span><span>        </span><span class="identifier">values</span><span>
    }
}</span></code></pre>
        <p>Next, we can add a <code>LayoutIR</code> subtype to our <code>Component</code>. It may use <code>Explore</code>&#39;s
        <code>LayoutDirection</code> type for consistency.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span>    </span><span class="keyword">case</span><span> </span><span class="type-name">LayoutIR</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">direction</span><span>: </span><span class="type-name">LayoutDirection</span><span>, </span><span class="identifier">a</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">A</span><span>], </span><span class="identifier">b</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">B</span><span>]) </span><span class="keyword">extends</span><span> </span><span class="type-name">Component</span><span>[(</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>)]</span></code></pre>
        <p>Adding it to <code>runAndMakeUI</code>, we get:</p>
        <pre><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">runAndMakeUI</span><span>: (</span><span class="type-name">JComponent</span><span>, </span><span class="type-name">Stream</span><span>[</span><span class="type-name">Pure</span><span>, </span><span class="type-name">A</span><span>]) = </span><span class="keyword">this</span><span> </span><span class="keyword">match</span><span> {
    </span><span class="keyword">case</span><span> </span><span class="type-name">IntIR</span><span>(</span><span class="identifier">labelText</span><span>, (</span><span class="identifier">start</span><span>, </span><span class="identifier">end</span><span>), </span><span class="identifier">initial</span><span>) =&gt;
        ...

    </span><span class="keyword">case</span><span> </span><span class="type-name">LayoutIR</span><span>(</span><span class="identifier">direction</span><span>, </span><span class="identifier">a</span><span>, </span><span class="identifier">b</span><span>) =&gt;
      </span><span class="keyword">val</span><span> (</span><span class="identifier">aUI</span><span>, </span><span class="identifier">aValues</span><span>) = </span><span class="identifier">a</span><span>.</span><span class="identifier">runAndMakeUI</span><span>
      </span><span class="keyword">val</span><span> (</span><span class="identifier">bUI</span><span>, </span><span class="identifier">bValues</span><span>) = </span><span class="identifier">b</span><span>.</span><span class="identifier">runAndMakeUI</span><span>

      </span><span class="keyword">val</span><span> </span><span class="identifier">directionInt</span><span> = </span><span class="identifier">direction</span><span> </span><span class="keyword">match</span><span> {
        </span><span class="keyword">case</span><span> </span><span class="type-name">LayoutDirection</span><span>.</span><span class="type-name">Horizontal</span><span> =&gt; </span><span class="type-name">BoxLayout</span><span>.</span><span class="type-name">X_AXIS</span><span>
        </span><span class="keyword">case</span><span> </span><span class="type-name">LayoutDirection</span><span>.</span><span class="type-name">Vertical</span><span>   =&gt; </span><span class="type-name">BoxLayout</span><span>.</span><span class="type-name">Y_AXIS</span><span>,
      }

      </span><span class="keyword">val</span><span> </span><span class="identifier">panel</span><span> = </span><span class="type-name">JPanel</span><span>()
      </span><span class="identifier">panel</span><span>.</span><span class="identifier">setLayout</span><span>(</span><span class="type-name">BoxLayout</span><span>(</span><span class="identifier">panel</span><span>, </span><span class="identifier">direction</span><span>))
      </span><span class="identifier">panel</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">a</span><span>)
      </span><span class="identifier">panel</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">b</span><span>)

      </span><span class="keyword">val</span><span> </span><span class="identifier">zippedValues</span><span> = </span><span class="identifier">aValues</span><span>.</span><span class="identifier">zip</span><span>(</span><span class="identifier">bValues</span><span>)
      (</span><span class="identifier">panel</span><span>, </span><span class="identifier">zippedValues</span><span>)
}</span></code></pre>
        <p>Next, the <code>explore.Layout</code> implementation:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">implicit</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">LayoutInterpreter</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">Layout</span><span>[</span><span class="type-name">Component</span><span>] {
  </span><span class="keyword">import</span><span> </span><span class="type-name">Component</span><span>.</span><span class="type-name">LayoutIR</span><span>

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">above</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">top</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">A</span><span>], </span><span class="identifier">bottom</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">B</span><span>]) =
    </span><span class="type-name">LayoutIR</span><span>(</span><span class="type-name">LayoutDirection</span><span>.</span><span class="type-name">Vertical</span><span>, </span><span class="identifier">top</span><span>, </span><span class="identifier">bottom</span><span>)

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">beside</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">left</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">A</span><span>], </span><span class="identifier">right</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">B</span><span>]) =
    </span><span class="type-name">LayoutIR</span><span>(</span><span class="type-name">LayoutDirection</span><span>.</span><span class="type-name">Horizontal</span><span>, </span><span class="identifier">left</span><span>, </span><span class="identifier">right</span><span>)
}</span></code></pre>
        <p>Our final code looks like this:</p>
        <pre><code class="nohighlight"><span class="keyword">enum</span><span> </span><span class="type-name">Component</span><span>[</span><span class="type-name">A</span><span>] </span><span class="keyword">extends</span><span> </span><span class="type-name">Explorer</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">Drawing</span><span>, </span><span class="type-name">Algebra</span><span>, </span><span class="type-name">Canvas</span><span>, </span><span class="type-name">Frame</span><span>] {
    </span><span class="keyword">case</span><span> </span><span class="type-name">IntIR</span><span>(</span><span class="identifier">label</span><span>: </span><span class="type-name">String</span><span>, </span><span class="identifier">bounds</span><span>: (</span><span class="type-name">Int</span><span>, </span><span class="type-name">Int</span><span>), </span><span class="identifier">initial</span><span>: </span><span class="type-name">Int</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">Component</span><span>[</span><span class="type-name">Int</span><span>]
    </span><span class="keyword">case</span><span> </span><span class="type-name">LayoutIR</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">direction</span><span>: </span><span class="type-name">LayoutDirection</span><span>, </span><span class="identifier">a</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">A</span><span>], </span><span class="identifier">b</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">B</span><span>]) </span><span class="keyword">extends</span><span> </span><span class="type-name">Component</span><span>[(</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>)]

    </span><span class="keyword">def</span><span> </span><span class="declaration-name">runAndMakeUI</span><span>: (</span><span class="type-name">JComponent</span><span>, </span><span class="type-name">Stream</span><span>[</span><span class="type-name">Pure</span><span>, </span><span class="type-name">A</span><span>]) = </span><span class="keyword">this</span><span> </span><span class="keyword">match</span><span> {
        </span><span class="keyword">case</span><span> </span><span class="type-name">IntIR</span><span>(</span><span class="identifier">labelText</span><span>, (</span><span class="identifier">start</span><span>, </span><span class="identifier">end</span><span>), </span><span class="identifier">initial</span><span>) =&gt;
            </span><span class="keyword">val</span><span> </span><span class="identifier">panel</span><span> = </span><span class="type-name">JPanel</span><span>()
            </span><span class="keyword">val</span><span> </span><span class="identifier">label</span><span> = </span><span class="type-name">JLabel</span><span>(</span><span class="identifier">labelText</span><span>)
            </span><span class="keyword">val</span><span> </span><span class="identifier">slider</span><span> = </span><span class="type-name">JSlider</span><span>(</span><span class="identifier">start</span><span>, </span><span class="identifier">end</span><span>, </span><span class="identifier">initial</span><span>)

            </span><span class="identifier">panel</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">label</span><span>, </span><span class="identifier">panel</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">slider</span><span>))
            </span><span class="keyword">val</span><span> </span><span class="identifier">values</span><span> = </span><span class="type-name">Stream</span><span>(</span><span class="identifier">initial</span><span>).</span><span class="identifier">repeat</span><span>.</span><span class="identifier">map</span><span>(</span><span class="identifier">_</span><span> =&gt; </span><span class="identifier">slider</span><span>.</span><span class="identifier">getValue</span><span>)

            (</span><span class="identifier">panel</span><span>, </span><span class="identifier">values</span><span>)

        </span><span class="keyword">case</span><span> </span><span class="type-name">LayoutIR</span><span>(</span><span class="identifier">direction</span><span>, </span><span class="identifier">a</span><span>, </span><span class="identifier">b</span><span>) =&gt;
          </span><span class="keyword">val</span><span> (</span><span class="identifier">aUI</span><span>, </span><span class="identifier">aValues</span><span>) = </span><span class="identifier">a</span><span>.</span><span class="identifier">runAndMakeUI</span><span>
          </span><span class="keyword">val</span><span> (</span><span class="identifier">bUI</span><span>, </span><span class="identifier">bValues</span><span>) = </span><span class="identifier">b</span><span>.</span><span class="identifier">runAndMakeUI</span><span>

          </span><span class="keyword">val</span><span> </span><span class="identifier">directionInt</span><span> = </span><span class="identifier">direction</span><span> </span><span class="keyword">match</span><span> {
            </span><span class="keyword">case</span><span> </span><span class="type-name">LayoutDirection</span><span>.</span><span class="type-name">Horizontal</span><span> =&gt; </span><span class="type-name">BoxLayout</span><span>.</span><span class="type-name">X_AXIS</span><span>
            </span><span class="keyword">case</span><span> </span><span class="type-name">LayoutDirection</span><span>.</span><span class="type-name">Vertical</span><span>   =&gt; </span><span class="type-name">BoxLayout</span><span>.</span><span class="type-name">Y_AXIS</span><span>,
          }

          </span><span class="keyword">val</span><span> </span><span class="identifier">panel</span><span> = </span><span class="type-name">JPanel</span><span>()
          </span><span class="identifier">panel</span><span>.</span><span class="identifier">setLayout</span><span>(</span><span class="type-name">BoxLayout</span><span>(</span><span class="identifier">panel</span><span>, </span><span class="identifier">direction</span><span>))
          </span><span class="identifier">panel</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">a</span><span>)
          </span><span class="identifier">panel</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">b</span><span>)

          </span><span class="keyword">val</span><span> </span><span class="identifier">zippedValues</span><span> = </span><span class="identifier">aValues</span><span>.</span><span class="identifier">zip</span><span>(</span><span class="identifier">bValues</span><span>)
          (</span><span class="identifier">panel</span><span>, </span><span class="identifier">zippedValues</span><span>)
    }

    </span><span class="keyword">def</span><span> </span><span class="declaration-name">run</span><span>: </span><span class="type-name">Stream</span><span>[</span><span class="type-name">Pure</span><span>, </span><span class="type-name">A</span><span>] = {
        </span><span class="keyword">val</span><span> </span><span class="identifier">frame</span><span> = </span><span class="type-name">JFrame</span><span>(</span><span class="string-literal">&quot;Explorer&quot;</span><span>)

        </span><span class="keyword">val</span><span> (</span><span class="identifier">ui</span><span>, </span><span class="identifier">values</span><span>) = </span><span class="identifier">runAndMakeUI</span><span>

        </span><span class="comment">// displaying the UI
</span><span>        </span><span class="identifier">frame</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">ui</span><span>)
        </span><span class="identifier">frame</span><span>.</span><span class="identifier">setVisible</span><span>(</span><span class="boolean-literal">true</span><span>)
        </span><span class="identifier">frame</span><span>.</span><span class="identifier">pack</span><span>

        </span><span class="comment">// returning the values stream
</span><span>        </span><span class="identifier">values</span><span>
    }
}

</span><span class="keyword">implicit</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">IntInterpreter</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">ExploreInt</span><span>[</span><span class="type-name">Component</span><span>] {
  </span><span class="keyword">import</span><span> </span><span class="type-name">Component</span><span>.</span><span class="type-name">IntIR</span><span>

  </span><span class="comment">// Construct a brand new IntIR
</span><span>  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">int</span><span>(</span><span class="identifier">label</span><span>: </span><span class="type-name">String</span><span>) = </span><span class="type-name">IntIR</span><span>(</span><span class="identifier">label</span><span>, </span><span class="type-name">None</span><span>, </span><span class="number-literal">0</span><span>)

  </span><span class="comment">// Pattern match to retrieve `generator` as the IntIR subtype, and then
</span><span>  </span><span class="comment">// update it.
</span><span>  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">within</span><span>(</span><span class="identifier">generator</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">Int</span><span>], </span><span class="identifier">start</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">end</span><span>: </span><span class="type-name">Int</span><span>) =
    </span><span class="identifier">generator</span><span> </span><span class="keyword">match</span><span> {
      </span><span class="keyword">case</span><span> </span><span class="identifier">generator</span><span>: </span><span class="type-name">IntIR</span><span> =&gt;
        </span><span class="identifier">generator</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">bounds</span><span> = </span><span class="type-name">Some</span><span>(</span><span class="identifier">start</span><span>, </span><span class="identifier">end</span><span>), </span><span class="identifier">initial</span><span> = (</span><span class="identifier">start</span><span> + </span><span class="identifier">end</span><span>) / </span><span class="number-literal">2</span><span>)
    }

  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">withDefault</span><span>(</span><span class="identifier">generator</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">Int</span><span>], </span><span class="identifier">newInitial</span><span>: </span><span class="type-name">Int</span><span>) =
    </span><span class="identifier">generator</span><span> </span><span class="keyword">match</span><span> {
      </span><span class="keyword">case</span><span> </span><span class="identifier">generator</span><span>: </span><span class="type-name">IntIR</span><span> =&gt; 
        </span><span class="identifier">generator</span><span>.</span><span class="identifier">copy</span><span>(</span><span class="identifier">initial</span><span> = </span><span class="identifier">newInitial</span><span>)
    }
}

</span><span class="keyword">implicit</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">LayoutInterpreter</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">Layout</span><span>[</span><span class="type-name">Component</span><span>] {
  </span><span class="keyword">import</span><span> </span><span class="type-name">Component</span><span>.</span><span class="type-name">LayoutIR</span><span>

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">above</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">top</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">A</span><span>], </span><span class="identifier">bottom</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">B</span><span>]) =
    </span><span class="type-name">LayoutIR</span><span>(</span><span class="type-name">LayoutDirection</span><span>.</span><span class="type-name">Vertical</span><span>, </span><span class="identifier">top</span><span>, </span><span class="identifier">bottom</span><span>)

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">beside</span><span>[</span><span class="type-name">A</span><span>, </span><span class="type-name">B</span><span>](</span><span class="identifier">left</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">A</span><span>], </span><span class="identifier">right</span><span>: </span><span class="type-name">Component</span><span>[</span><span class="type-name">B</span><span>]) =
    </span><span class="type-name">LayoutIR</span><span>(</span><span class="type-name">LayoutDirection</span><span>.</span><span class="type-name">Horizontal</span><span>, </span><span class="identifier">left</span><span>, </span><span class="identifier">right</span><span>)
}</span></code></pre>

        <hr style="margin-top: 30px"/>
        <footer style="font-size: 90%; text-align: center">
          Doodle Explore is a <a href="https://creativescala.org/">Creative Scala</a> project distributed under the <a href="https://www.apache.org/licenses/LICENSE-2.0.txt">Apache-2.0</a> license.
        </footer>

      </main>

    </div>

  </body>
</html>
